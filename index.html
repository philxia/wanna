<html>
	<head>
		<title>Wanna app</title>

		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
	  	<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
	  	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
		<script type="text/javascript" src="js/controls/OrbitControls.js"></script>
		<script src="modelloader.js"></script>
		<style>
		canvas 
		{ 
			width: 100%; height: 100% 
		}
		
		div#canvas-frame
		{
		    border: none;
		    cursor: pointer;
		    width: 100%;
		    height: 100%;
		    background-color: #EEEEEE;
		}

		.ui-progressbar {
	  		position: absolute;
	  		left: 50;
	  		top: 32;
	  		height: 15;
	  		width: 200;
	  	}
	  	.progress-label {
	  		position: absolute;
	  		font-size: 5;
	  		font-weight: bold;
	  		text-shadow: 1px 1px 0 #fff;
	  		z-index: 120;
	  	}
		</style>
	</head>
	<body>
		<script type="x-shader/x-vertex" id="vertexShader">
		varying vec3 vWorldPosition;
		void main()
		{
			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0);
		}
		</script>
		<script type="x-shader/x-fragment" id="fragmentShader">
			uniform vec3 topColor;
			uniform vec3 bottomColor;
			uniform float offset;
			uniform float exponent;

			varying vec3 vWorldPosition;

			void main()
			{
				float h = normalize( vWorldPosition + offset ).y;
				gl_FragColor = vec4( mix(bottomColor, topColor, max(pow(h, exponent), 0.0)), 1.0);
			}
		</script>
		<script>
			

			var camera, controls, scene, renderer;

			$(document).ready(function(){

				var progressbar = $( "#progressbar" ),
			      progressLabel = $( ".progress-label" );
			 
			    progressbar.progressbar({
			      value: false,
			      change: function() {
			        progressLabel.text( progressbar.progressbar( "value" ) + "%" );
			      },
			      complete: function() {
			        progressLabel.text( "Complete!" );
			      }
			    });



				// Our Javascript will go here.
				scene = new THREE.Scene();
				scene.fog = new THREE.Fog(0xffffff, 1, 5000);
				scene.fog.color.setHSL( 0.6, 0, 1 );


				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 10000 );
				controls = new THREE.OrbitControls(camera);
				controls.addEventListener('change', render);

				renderer = new THREE.WebGLRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.getElementById('canvas-frame').appendChild( renderer.domElement );

				// add light node.
				// threejs.org/examples/webgl_lights_hemisphere.html
				var hemiLight = new THREE.HemisphereLight( 0xffffff, 0xffffff, 0.6);
				hemiLight.color.setHSL( 0.6, 1, 0.6);
				hemiLight.groundColor.setHSL( 0.095, 1, 0.75);
				hemiLight.position.set(0, 500, 0);
				scene.add(hemiLight);

				var dirLight = new THREE.DirectionalLight( 0xffffff, 1);
				dirLight.color.setHSL( 0.1, 1, 0.95 );
				dirLight.position.set(-1, 1.75, 1 );
				dirLight.position.multiplyScalar( 50 );
				scene.add( dirLight );
				
				// GROUND
				var groundGeo = new THREE.PlaneGeometry( 10000, 10000);
				var groundMat = new THREE.MeshPhongMaterial({ ambient: 0xffffff, color: 0xffffff, specular: 0x050505 });

				var ground = new THREE.Mesh(groundGeo, groundMat);
				ground.rotation.x = -Math.PI/2;
				ground.position.y = -33;
				scene.add(ground);

				// SKYDEMO
				var vertexShader = document.getElementById('vertexShader').textContent;
				var fragmentShader = document.getElementById('fragmentShader').textContent;
				var uniforms = {
					topColor: {type:"c", value: new THREE.Color(0x0077ff)},
					bottomColor: {type:"c", value: new THREE.Color(0xffffff)},
					offset: {type:"f", value: 33},
					exponent: {type:"f", value: 0.6}
				};
				uniforms.topColor.value.copy(hemiLight.color);
				scene.fog.color.copy(uniforms.bottomColor.value);

				var skyGeo = new THREE.SphereGeometry( 4000, 32, 15);
				var skyMat = new THREE.ShaderMaterial({vertexShader: vertexShader, fragmentShader: fragmentShader, uniforms: uniforms, side: THREE.BackSide });
				var sky = new THREE.Mesh( skyGeo, skyMat );
				scene.add( sky );

				camera.position.z = 5;




				// load model.
				modelloader.loadmodel(scene);

				window.addEventListener( 'resize', onWindowResize, false );
				// $(window).resize(function(arg){
				// 	// update the resolution of the webgl window when the canvas size is changing.
				// 	renderer.setSize(window.innerWidth, window.innerHeight);

				// 	// keep the aspect when the canvas size is changing.
				// 	camera.aspect = window.innerWidth / window.innerHeight;
				// 	camera.updateProjectionMatrix();
				// });
			});

			function onWindowResize() 
			{

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

				render();
			}

			
				function render() {
					// requestAnimationFrame(render);

					// cube.rotation.x += 0.1;
					// cube.rotation.y += 0.1;
					renderer.render(scene, camera);
				}
		</script>
		<div id="progressbar"><div class="progress-label">Loading...</div></div>
		<div id="canvas-frame"></div>
	</body>
</html>